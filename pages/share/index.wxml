<!--pages/share/index.wxml-->
<view class="container">
  <!-- Canvas 预览区域 -->
  <view class="canvas-wrapper {{currentMode === 'wallpaper' ? 'wallpaper-mode-wrapper' : ''}}">
    <view class="canvas-container">
      <canvas 
        type="2d" 
        id="preview-canvas" 
        class="preview-canvas"
        style="width: {{canvasStyleWidth}}; height: {{canvasStyleHeight}};"
      ></canvas>
      <!-- 二维码 Widget 浮动层（壁纸模式下显示） -->
      <view 
        wx:if="{{currentMode === 'wallpaper' && qrWidgetX !== null && qrWidgetY !== null}}"
        class="qr-widget-overlay"
        style="left: {{qrWidgetOverlayLeft}}px; top: {{qrWidgetOverlayTop}}px; width: {{qrWidgetOverlayWidth}}px; height: {{qrWidgetOverlayHeight}}px; opacity: {{isSaving ? 0 : 1}};"
        catchtouchstart="onQRWidgetTouchStart"
        catchtouchmove="onQRWidgetTouchMove"
        catchtouchend="onQRWidgetTouchEnd"
      >
        <view class="widget-content">
          <image wx:if="{{qrCodePath}}" class="widget-qr" src="{{qrCodePath}}" mode="aspectFit"></image>
          <view class="widget-text-group">
            <text class="widget-text-title">请在机主需要帮助时</text>
            <text class="widget-text-desc">扫码查看紧急联系人</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- Tab 切换按钮 -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentMode === 'print' ? 'active' : ''}}" 
      bindtap="onTabChange" 
      data-mode="print"
    >
      <text class="tab-icon">🖨️</text>
      <text class="tab-text">实体打印版</text>
    </view>
    <view 
      class="tab-item {{currentMode === 'wallpaper' ? 'active' : ''}}" 
      bindtap="onTabChange" 
      data-mode="wallpaper"
    >
      <text class="tab-icon">📱</text>
      <text class="tab-text">手机壁纸版</text>
    </view>
  </view>

  <!-- 底部操作区 -->
  <view class="action-area">
    <!-- 打印版操作区 -->
    <view wx:if="{{currentMode === 'print'}}" class="print-actions">
      <view class="safety-tip">
        <text class="tip-text">温馨提示：此二维码仅包含紧急联系方式，不含身份证等敏感隐私，请放心扫码。</text>
      </view>
      <view class="footer-action-bar">
        <button class="save-btn main-btn print-btn" bindtap="onSavePrintImage">保存打印图片</button>
        <view class="nfc-btn side-btn" bindtap="copyNfcLink">
          <text class="nfc-icon">🔗</text>
          <text class="nfc-text">NFC</text>
        </view>
      </view>
    </view>

    <!-- 壁纸版操作区 -->
    <view wx:else class="wallpaper-actions">
      <view class="bg-selector">
        <view class="bg-option" bindtap="onUploadPhoto">
          <text class="bg-option-icon">📸</text>
          <text class="bg-option-text">上传照片</text>
        </view>
        <view class="bg-option" bindtap="onSelectDefaultBg">
          <text class="bg-option-icon">🎨</text>
          <text class="bg-option-text">选择默认背景</text>
        </view>
      </view>

      <!-- 默认背景选择器 -->
      <view wx:if="{{showDefaultBgSelector}}" class="default-bg-list">
        <view 
          class="default-bg-item {{selectedBgIndex === index ? 'selected' : ''}}"
          wx:for="{{defaultWallpapers}}" 
          wx:key="index"
          bindtap="onSelectBg"
          data-index="{{index}}"
        >
          <image class="bg-thumbnail" src="{{item}}" mode="aspectFill"></image>
        </view>
      </view>

      <view class="footer-action-bar">
        <button class="save-btn main-btn wallpaper-btn" bindtap="onSaveWallpaperImage">保存壁纸图片</button>
      </view>
    </view>
  </view>
</view>