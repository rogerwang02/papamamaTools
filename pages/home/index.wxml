<!--pages/home/index.wxml-->
<view class="container">
  <!-- 顶部欢迎语 -->
  <view class="header">
    <text class="welcome-title">您好，守护者</text>
    <text class="welcome-subtitle">今天也要关注家人的健康哦</text>
  </view>

  <!-- 核心区域：卡片状态 -->
  <view class="card-section">
    <!-- 状态 A: 加载中 -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-icon">⏳</view>
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 状态 B: 未创建卡片 -->
    <view wx:elif="{{!cardInfo}}" class="empty-card" bindtap="onCreateCard">
      <view class="empty-card-left">
        <view class="empty-icon">🛡️</view>
      </view>
      <view class="empty-card-right">
        <text class="empty-title">立即制作安心急救卡</text>
        <text class="empty-desc">关键时刻，让爱有备无患</text>
      </view>
    </view>

    <!-- 状态 C: 已创建卡片 -->
    <view wx:else class="card-container">
      <!-- 卡片头部 -->
      <view class="card-header">
        <view class="header-left">
          <text class="card-header-title">🚑 急救卡预览</text>
        </view>
        <view class="header-right">
          <view class="card-status">
            <view class="status-dot"></view>
            <text class="status-text">已激活</text>
          </view>
          <view class="delete-icon-btn" bindtap="onDeleteCard">
            <text class="delete-icon">🗑️</text>
          </view>
        </view>
      </view>

      <!-- 卡片内容 -->
      <view class="card-content">
        <!-- 姓名（超大号） -->
        <view class="card-name">{{cardInfo.name}}</view>
        
        <!-- 关键信息（两列布局） -->
        <view class="card-info-grid">
          <view class="card-info-col">
            <text class="card-info-label">血型</text>
            <text class="card-info-value blood-type">{{cardInfo.blood_type}}</text>
          </view>
          <view class="card-info-col">
            <text class="card-info-label">病史</text>
            <text class="card-info-value conditions">{{cardInfo.conditions || '无'}}</text>
          </view>
        </view>
      </view>

      <!-- 操作按钮网格 -->
      <view class="card-actions-grid">
        <view class="action-item" bindtap="onEditCard">
          <view class="action-icon-circle edit-icon">
            <text class="action-icon">📝</text>
          </view>
          <text class="action-text">编辑信息</text>
        </view>
        <view class="action-item" bindtap="onPreviewCard">
          <view class="action-icon-circle preview-icon">
            <text class="action-icon">👁️</text>
          </view>
          <text class="action-text">预览卡片</text>
        </view>
        <view class="action-item" bindtap="onShowQRCode">
          <view class="action-icon-circle qr-icon">
            <text class="action-icon">📱</text>
          </view>
          <text class="action-text">生成二维码</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 工具箱区域 -->
  <view class="utility-section" wx:if="{{!loading}}">
    <view class="section-title">贴心工具箱</view>
    <view class="utility-grid">
      <view class="utility-item" bindtap="onSOSCall">
        <view class="utility-icon-bg bg-red">
          <text class="utility-icon">🆘</text>
        </view>
        <text class="utility-label">一键呼救</text>
      </view>
      <view class="utility-item" bindtap="onOpenMedicalCard">
        <view class="utility-icon-bg bg-cyan">
          <text class="utility-icon">💳</text>
        </view>
        <text class="utility-label">电子医保卡</text>
      </view>
      <view class="utility-item" bindtap="onOpenTriage">
        <view class="utility-icon-bg bg-indigo">
          <text class="utility-icon">🤖</text>
        </view>
        <text class="utility-label">智能导诊</text>
      </view>
      <view class="utility-item" bindtap="onShowFirstAid">
        <view class="utility-icon-bg bg-purple">
          <text class="utility-icon">⛑️</text>
        </view>
        <text class="utility-label">急救常识</text>
      </view>
      <view class="utility-item" bindtap="onGoToToolbox">
        <view class="utility-icon-bg bg-gray">
          <text class="utility-icon">⋯</text>
        </view>
        <text class="utility-label">更多工具</text>
      </view>
    </view>
  </view>

  <!-- 健康打卡区域 -->
  <view class="habit-section" wx:if="{{!loading}}">
    <view class="section-title">今日健康打卡</view>
    <view class="habit-list">
      <block wx:for="{{habits}}" wx:key="id">
        <view class="habit-item {{item.done ? 'habit-done' : ''}}" bindtap="onToggleHabit" data-id="{{item.id}}">
          <view class="habit-icon">{{item.icon}}</view>
          <text class="habit-text">{{item.text}}</text>
          <view class="habit-checkbox">
            <text wx:if="{{item.done}}">✅</text>
            <view wx:else class="checkbox-circle"></view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <view class="footer-space"></view>
</view>

<!-- 医保凭证提示模态框 -->
<view wx:if="{{showMedicalCardModal}}" class="medical-card-modal">
  <view class="medical-card-modal-content">
    <view class="medical-card-modal-header">
      <text class="medical-card-modal-title">提示</text>
      <text class="medical-card-modal-close" bindtap="onCloseMedicalCardModal">×</text>
    </view>
    <view class="medical-card-modal-body">
      <text class="medical-card-modal-tip">即将打开腾讯健康小程序，点击左上角医保码</text>
      <image 
        class="medical-card-guide-image" 
        src="/assets/medical-card-guide.jpg" 
        mode="widthFix"
      ></image>
    </view>
    <view class="medical-card-modal-footer">
      <button class="medical-card-modal-btn cancel-btn" bindtap="onCloseMedicalCardModal">取消</button>
      <button class="medical-card-modal-btn confirm-btn" bindtap="onConfirmOpenMedicalCard">确定</button>
    </view>
  </view>
</view>

<!-- BMI计算器输入模态框 -->
<view wx:if="{{showBMIModal}}" class="bmi-modal show">
  <view class="bmi-modal-content">
    <view class="bmi-modal-header">
      <text class="bmi-modal-title">BMI计算器</text>
      <text class="bmi-modal-close" bindtap="onCloseBMIModal">×</text>
    </view>
    <view class="bmi-modal-body">
      <view class="bmi-input-item">
        <text class="bmi-input-label">身高（厘米）</text>
        <input 
          class="bmi-input" 
          type="digit" 
          placeholder="请输入身高，例如：165" 
          value="{{bmiHeight}}"
          bindinput="onBMIHeightInput"
          placeholder-class="bmi-input-placeholder"
          maxlength="3"
        />
      </view>
      <view class="bmi-input-item">
        <text class="bmi-input-label">体重（公斤）</text>
        <input 
          class="bmi-input" 
          type="digit" 
          placeholder="请输入体重，例如：65" 
          value="{{bmiWeight}}"
          bindinput="onBMIWeightInput"
          placeholder-class="bmi-input-placeholder"
          maxlength="3"
        />
      </view>
    </view>
    <view class="bmi-modal-footer">
      <button class="bmi-modal-btn cancel-btn" bindtap="onCloseBMIModal">取消</button>
      <button class="bmi-modal-btn confirm-btn" bindtap="onBMIConfirm">计算</button>
    </view>
  </view>
</view>

